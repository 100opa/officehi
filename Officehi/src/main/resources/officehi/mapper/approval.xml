<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.groupware.officehi.repository.ApprovalRepository">
	<insert id="save" useGeneratedKeys="true" keyProperty="approvalNo"
		parameterType="com.groupware.officehi.dto.ApprovalDTO$ApprovalSaveDTO">
		INSERT INTO approval(user_no, date, title, content, category, checker_1)
		VALUES (#{userNo}, curdate(), #{title}, #{content}, #{category}, (select user_no from user where name like #{checker1}))
	</insert>

	<select id="findByUserIdApprovalList">
		select (select name as user_name
		from user u
        where u.user_no = a.user_no) as 'user_name',
        approval_no,
        title,
        (select dept_name
		from user u
		where u.user_no = a.user_no) as 'dept_name',
		date,
        check_date
		from approval a;
	</select>
	
	<select id="findByUserNameAndDeptName">
		select user_no, name, dept_name from user;
	</select>

</mapper>